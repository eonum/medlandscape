{"ast":null,"code":"import _classCallCheck from \"/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/src/components/Graphs/LinearRegression.js\";\nimport React, { Component } from 'react';\nimport * as d3 from \"d3\";\nimport './LinearRegression.css';\nimport DropdownMenu from './../DropdownMenu/DropdownMenu.js';\nimport { withTranslation } from 'react-i18next';\n/**\n* LinearRegression is the entity we use to calculate and draw a scatterplot with a regression line.\n* The rendered JSX also consists of two dropdowns where variables can be selected to display a scatterplot.\n* The currently selected variables and language are stored in the state.\n*/\n\nvar LinearRegression =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LinearRegression, _Component);\n\n  function LinearRegression() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, LinearRegression);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(LinearRegression)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      xVariable: undefined,\n      yVariable: undefined,\n      language: _this.props.i18n.language\n    };\n\n    _this.returnData = function (item) {\n      var xVarName = _this.state.xVariable.name;\n      var yVarName = _this.state.yVariable.name;\n      var xValues = item.attributes[xVarName];\n      var yValues = item.attributes[yVarName];\n      var xData = xValues[_this.props.year];\n      var yData = yValues[_this.props.year];\n      return {\n        x: xData,\n        y: yData\n      };\n    };\n\n    _this.makeDataArrays = function () {\n      var xArray = [];\n      var yArray = [];\n      var objArray = [];\n\n      _this.props.hospitals.map(function (obj) {\n        var data = _this.returnData(obj);\n\n        if (data.x && data.y) {\n          // sort out undefined values for given year\n          xArray.push(data.x);\n          yArray.push(data.y);\n          objArray.push(obj);\n        }\n      });\n\n      return {\n        x: xArray,\n        y: yArray,\n        obj: objArray //pointer to the hospital\n\n      };\n    };\n\n    _this.findHospitalInfo = function (x, y, xArr, yArr) {};\n\n    _this.createChartdata = function () {\n      var dataArrays = _this.makeDataArrays();\n\n      var x = dataArrays.x;\n      var y = dataArrays.y;\n      var obj = dataArrays.obj;\n      var n = x.length; // create x and y sums\n\n      var xSum = 0;\n      var ySum = 0;\n\n      for (var i = 0; i < n; i++) {\n        xSum += x[i];\n        ySum += y[i];\n      } // calculate mean x and y\n\n\n      var xMean = xSum / n;\n      var yMean = ySum / n; // calculate coefficients\n\n      var xvariance = 0;\n      var yvariance = 0;\n      var term1 = 0;\n      var term2 = 0;\n\n      for (i = 0; i < x.length; i++) {\n        xvariance = x[i] - xMean;\n        yvariance = y[i] - yMean;\n        term1 += xvariance * yvariance;\n        term2 += xvariance * xvariance;\n      }\n\n      var b1 = term1 / term2;\n      var b0 = yMean - b1 * xMean; // perform regression\n\n      var yhat = []; // fit line using coeffs\n\n      for (i = 0; i < x.length; i++) {\n        yhat.push(b0 + x[i] * b1);\n      } // create actual data objects\n\n\n      var data = [];\n\n      for (i = 0; i < y.length && i < x.length; i++) {\n        data.push({\n          yhat: yhat[i],\n          y: y[i],\n          x: x[i],\n          obj: obj[i]\n        });\n      }\n\n      return data;\n    };\n\n    _this.selectXAxis = function (item) {\n      _this.setState({\n        xVariable: item\n      }, function () {\n        _this.updateChart();\n      });\n    };\n\n    _this.selectYAxis = function (item) {\n      _this.setState({\n        yVariable: item\n      }, function () {\n        _this.updateChart();\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(LinearRegression, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      // check if response is there and draw chart if so\n      if (this.props.tableDataLoaded) this.drawChart();\n    }\n    /**\n    * Returns the values stored in a this.props.objects canton/hospital\n    * @param  {Canton || Hospital Object} item The object to extract the values from\n    * @return {Object} with x: Data for the xVariable and y: Data for the yVariable\n    */\n\n  }, {\n    key: \"drawChart\",\n\n    /**\n     * Draws a Scatterplot with a regression line\n     */\n    value: function drawChart() {\n      //remove old svg\n      d3.select(\"#linearregressionsvg\").remove();\n      var w = 960;\n      var h = 500;\n      var padding = 30; //create data points\n\n      var dataset = this.createChartdata(); // function for creation of regression line\n\n      var newline = d3.line().x(function (d) {\n        return xScale(d.x);\n      }).y(function (d) {\n        return yScale(d.yhat);\n      }); // Define Scales\n\n      var xScale = d3.scaleLinear().domain([0, d3.max(dataset, function (d) {\n        return d.x;\n      })]).range([padding, w - padding * 2]);\n      var yScale = d3.scaleLinear().domain([d3.min(dataset, function (d) {\n        return d.y;\n      }), d3.max(dataset, function (d) {\n        return d.y;\n      })]) //y range is reversed because svg\n      .range([h - padding, padding]); // Define Axis\n\n      var xAxis = d3.axisBottom().scale(xScale);\n      var yAxis = d3.axisLeft().scale(yScale).ticks(5); // Add a tooltip div. Here I define the general feature of the tooltip: stuff that do not depend on the data point.\n      // Its opacity is set to 0: we don't see it by default.\n\n      var tooltip = d3.select(\"#linearregression\").append(\"div\").style(\"opacity\", 0).attr(\"class\", \"tooltip\"); // function that changes  tooltip when the user hovers over a point.\n      // opacity is set to 1: we can now see it. Plus it set the text and position of tooltip depending on the datapoint (d)\n\n      var mouseover = function mouseover(d) {\n        d3.select(\"#linearregression .tooltip\").style(\"opacity\", 1).text(d.obj.name);\n      };\n\n      var mousemove = function mousemove(d) {\n        d3.select(\"#linearregression .tooltip\").style(\"left\", d3.event.pageX + \"px\").style(\"top\", d3.event.pageY - 28 + \"px\");\n      }; // A function that change this tooltip when the leaves a point: just need to set opacity to 0 again\n\n\n      var mouseleave = function mouseleave(d) {\n        d3.select(\"#linearregression .tooltip\").transition().duration(200).style(\"opacity\", 0);\n      }; // create svg\n\n\n      var svg = d3.select(\"#linearregression\").append(\"svg\").attr(\"id\", \"linearregressionsvg\").attr(\"width\", w).attr(\"height\", h); // cut off datapoints that are outside the axis\n\n      svg.append(\"clipPath\").attr(\"id\", \"chart-area\").append(\"rect\").attr(\"x\", padding).attr(\"y\", padding).attr(\"width\", w - padding * 3).attr(\"height\", h - padding * 2); // append data points\n\n      svg.append(\"g\").attr(\"id\", \"circles\").attr(\"clip-path\", \"url(#chart-area)\").selectAll(\"circle\").data(dataset, function (d) {\n        return d;\n      }).enter().append(\"circle\").attr(\"class\", \"dot\").attr(\"cx\", function (d) {\n        return xScale(d.x);\n      }).attr(\"cy\", function (d) {\n        return yScale(d.y);\n      }).attr(\"r\", 3.5).on(\"mouseover\", mouseover).on(\"mousemove\", mousemove).on(\"mouseleave\", mouseleave); // append regression line\n\n      svg.append(\"path\").datum(dataset).attr(\"clip-path\", \"url(#chart-area)\").attr(\"class\", \"line\").attr(\"d\", newline); // append Axes\n\n      svg.append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", \"translate(0,\" + (h - padding) + \")\").call(xAxis);\n      svg.append(\"g\").attr(\"class\", \"y axis\").attr(\"transform\", \"translate(\" + padding + \",0)\").call(yAxis); // call this to set back and prepare for reupdate\n\n      this.props.tableDataGenerated();\n    }\n  }, {\n    key: \"updateChart\",\n\n    /**\n    * check if both x and y variable have been selected\n    * update selected variables in state if so\n    */\n    value: function updateChart() {\n      if (this.state.xVariable && this.state.yVariable) this.props.requestData([this.state.xVariable, this.state.yVariable]);\n    }\n  }, {\n    key: \"componentWillUpdate\",\n    value: function componentWillUpdate() {\n      // if the language is changed,set back variables and remove chart\n      if (this.props.i18n.language !== this.state.language) {\n        this.setState({\n          language: this.props.i18n.language,\n          xVariable: undefined,\n          yVariable: undefined\n        });\n        d3.select(\"#linearregressionsvg\").remove();\n      }\n    }\n    /**\n     * Creates zwo dropdowns and scatterplot with regression line\n     * @return {JSX}\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"linearregression\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }), React.createElement(DropdownMenu, {\n        id: \"xAxis\",\n        listItems: this.props.variables,\n        selectItem: this.selectXAxis,\n        selectedItem: this.state.xVariable,\n        defaultText: this.props.t('dropDowns.variablesFallback'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311\n        },\n        __self: this\n      }), React.createElement(DropdownMenu, {\n        id: \"yAxis\",\n        listItems: this.props.variables,\n        selectItem: this.selectYAxis,\n        selectedItem: this.state.yVariable,\n        defaultText: this.props.t('dropDowns.variablesFallback'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return LinearRegression;\n}(Component);\n\nvar LocalizedLinearRegression = withTranslation()(LinearRegression);\nexport default LocalizedLinearRegression;","map":{"version":3,"sources":["/Users/moriarty/Documents/UniBe/PSE/medlandscape/medlandscape-app/src/components/Graphs/LinearRegression.js"],"names":["React","Component","d3","DropdownMenu","withTranslation","LinearRegression","state","xVariable","undefined","yVariable","language","props","i18n","returnData","item","xVarName","name","yVarName","xValues","attributes","yValues","xData","year","yData","x","y","makeDataArrays","xArray","yArray","objArray","hospitals","map","obj","data","push","findHospitalInfo","xArr","yArr","createChartdata","dataArrays","n","length","xSum","ySum","i","xMean","yMean","xvariance","yvariance","term1","term2","b1","b0","yhat","selectXAxis","setState","updateChart","selectYAxis","tableDataLoaded","drawChart","select","remove","w","h","padding","dataset","newline","line","d","xScale","yScale","scaleLinear","domain","max","range","min","xAxis","axisBottom","scale","yAxis","axisLeft","ticks","tooltip","append","style","attr","mouseover","text","mousemove","event","pageX","pageY","mouseleave","transition","duration","svg","selectAll","enter","on","datum","call","tableDataGenerated","requestData","variables","t","LocalizedLinearRegression"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAO,wBAAP;AACA,OAAOC,YAAP,MAAyB,mCAAzB;AACA,SAASC,eAAT,QAAgC,eAAhC;AAEA;;;;;;IAKMC,gB;;;;;;;;;;;;;;;;;UAELC,K,GAAQ;AACDC,MAAAA,SAAS,EAAGC,SADX;AAEDC,MAAAA,SAAS,EAAGD,SAFX;AAGPE,MAAAA,QAAQ,EAAE,MAAKC,KAAL,CAAWC,IAAX,CAAgBF;AAHnB,K;;UAiBNG,U,GAAa,UAACC,IAAD,EAAU;AACtB,UAAIC,QAAQ,GAAG,MAAKT,KAAL,CAAWC,SAAX,CAAqBS,IAApC;AACA,UAAIC,QAAQ,GAAG,MAAKX,KAAL,CAAWG,SAAX,CAAqBO,IAApC;AACA,UAAIE,OAAO,GAAGJ,IAAI,CAACK,UAAL,CAAgBJ,QAAhB,CAAd;AACA,UAAIK,OAAO,GAAGN,IAAI,CAACK,UAAL,CAAgBF,QAAhB,CAAd;AACA,UAAII,KAAK,GAAGH,OAAO,CAAC,MAAKP,KAAL,CAAWW,IAAZ,CAAnB;AACA,UAAIC,KAAK,GAAGH,OAAO,CAAC,MAAKT,KAAL,CAAWW,IAAZ,CAAnB;AACA,aAAO;AACNE,QAAAA,CAAC,EAAEH,KADG;AAENI,QAAAA,CAAC,EAAEF;AAFG,OAAP;AAIA,K;;UAMDG,c,GAAiB,YAAM;AACtB,UAAIC,MAAM,GAAG,EAAb;AACA,UAAIC,MAAM,GAAG,EAAb;AACA,UAAIC,QAAQ,GAAG,EAAf;;AACA,YAAKlB,KAAL,CAAWmB,SAAX,CAAqBC,GAArB,CAAyB,UAACC,GAAD,EAAS;AACjC,YAAIC,IAAI,GAAG,MAAKpB,UAAL,CAAgBmB,GAAhB,CAAX;;AACA,YAAIC,IAAI,CAACT,CAAL,IAAUS,IAAI,CAACR,CAAnB,EAAqB;AAAE;AACxBE,UAAAA,MAAM,CAACO,IAAP,CAAYD,IAAI,CAACT,CAAjB;AACAI,UAAAA,MAAM,CAACM,IAAP,CAAYD,IAAI,CAACR,CAAjB;AACAI,UAAAA,QAAQ,CAACK,IAAT,CAAcF,GAAd;AACE;AACD,OAPD;;AAQA,aAAO;AACNR,QAAAA,CAAC,EAAEG,MADG;AAENF,QAAAA,CAAC,EAAEG,MAFG;AAGNI,QAAAA,GAAG,EAAEH,QAHC,CAGS;;AAHT,OAAP;AAKA,K;;UAuIHM,gB,GAAmB,UAACX,CAAD,EAAIC,CAAJ,EAAOW,IAAP,EAAaC,IAAb,EAAsB,CAExC,C;;UAEDC,e,GAAkB,YAAM;AACvB,UAAIC,UAAU,GAAG,MAAKb,cAAL,EAAjB;;AACA,UAAIF,CAAC,GAAGe,UAAU,CAACf,CAAnB;AACA,UAAIC,CAAC,GAAGc,UAAU,CAACd,CAAnB;AACA,UAAIO,GAAG,GAAGO,UAAU,CAACP,GAArB;AACA,UAAIQ,CAAC,GAAGhB,CAAC,CAACiB,MAAV,CALuB,CAOvB;;AACA,UAAIC,IAAI,GAAG,CAAX;AACA,UAAIC,IAAI,GAAG,CAAX;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,CAApB,EAAuBI,CAAC,EAAxB,EAA4B;AAC3BF,QAAAA,IAAI,IAAIlB,CAAC,CAACoB,CAAD,CAAT;AACAD,QAAAA,IAAI,IAAIlB,CAAC,CAACmB,CAAD,CAAT;AACA,OAbsB,CAevB;;;AACA,UAAIC,KAAK,GAAGH,IAAI,GAAGF,CAAnB;AACA,UAAIM,KAAK,GAAGH,IAAI,GAAGH,CAAnB,CAjBuB,CAmBvB;;AACA,UAAIO,SAAS,GAAG,CAAhB;AACA,UAAIC,SAAS,GAAG,CAAhB;AACA,UAAIC,KAAK,GAAG,CAAZ;AACA,UAAIC,KAAK,GAAG,CAAZ;;AACA,WAAKN,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGpB,CAAC,CAACiB,MAAlB,EAA0BG,CAAC,EAA3B,EAA+B;AAC9BG,QAAAA,SAAS,GAAGvB,CAAC,CAACoB,CAAD,CAAD,GAAOC,KAAnB;AACAG,QAAAA,SAAS,GAAGvB,CAAC,CAACmB,CAAD,CAAD,GAAOE,KAAnB;AACAG,QAAAA,KAAK,IAAIF,SAAS,GAAGC,SAArB;AACAE,QAAAA,KAAK,IAAIH,SAAS,GAAGA,SAArB;AACA;;AACD,UAAII,EAAE,GAAGF,KAAK,GAAGC,KAAjB;AACA,UAAIE,EAAE,GAAGN,KAAK,GAAIK,EAAE,GAAGN,KAAvB,CA/BuB,CAiCvB;;AACA,UAAIQ,IAAI,GAAG,EAAX,CAlCuB,CAoCvB;;AACA,WAAKT,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGpB,CAAC,CAACiB,MAAlB,EAA0BG,CAAC,EAA3B,EAA+B;AAC9BS,QAAAA,IAAI,CAACnB,IAAL,CAAUkB,EAAE,GAAI5B,CAAC,CAACoB,CAAD,CAAD,GAAOO,EAAvB;AACA,OAvCsB,CAyCvB;;;AACA,UAAIlB,IAAI,GAAG,EAAX;;AACA,WAAKW,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGnB,CAAC,CAACgB,MAAN,IAAgBG,CAAC,GAAGpB,CAAC,CAACiB,MAAlC,EAA0CG,CAAC,EAA3C,EAA+C;AAC9CX,QAAAA,IAAI,CAACC,IAAL,CAAU;AACTmB,UAAAA,IAAI,EAAEA,IAAI,CAACT,CAAD,CADD;AAETnB,UAAAA,CAAC,EAAEA,CAAC,CAACmB,CAAD,CAFK;AAGTpB,UAAAA,CAAC,EAAEA,CAAC,CAACoB,CAAD,CAHK;AAITZ,UAAAA,GAAG,EAAEA,GAAG,CAACY,CAAD;AAJC,SAAV;AAMA;;AACD,aAAOX,IAAP;AACA,K;;UAMEqB,W,GAAc,UAACxC,IAAD,EAAU;AAC1B,YAAKyC,QAAL,CAAc;AACbhD,QAAAA,SAAS,EAAGO;AADC,OAAd,EAEG,YAAM;AACR,cAAK0C,WAAL;AACA,OAJD;AAKA,K;;UAMEC,W,GAAc,UAAC3C,IAAD,EAAU;AAC1B,YAAKyC,QAAL,CAAc;AACb9C,QAAAA,SAAS,EAAGK;AADC,OAAd,EAEG,YAAM;AACR,cAAK0C,WAAL;AACA,OAJD;AAKA,K;;;;;;;yCApQmB;AACnB;AACA,UAAG,KAAK7C,KAAL,CAAW+C,eAAd,EACC,KAAKC,SAAL;AACD;AAED;;;;;;;;;AAyCA;;;gCAGY;AACX;AACAzD,MAAAA,EAAE,CAAC0D,MAAH,CAAU,sBAAV,EAAkCC,MAAlC;AAEA,UAAIC,CAAC,GAAG,GAAR;AACA,UAAIC,CAAC,GAAG,GAAR;AACA,UAAIC,OAAO,GAAG,EAAd,CANW,CAQX;;AACA,UAAIC,OAAO,GAAG,KAAK3B,eAAL,EAAd,CATW,CAWX;;AACA,UAAI4B,OAAO,GAAGhE,EAAE,CAACiE,IAAH,GACZ3C,CADY,CACV,UAAS4C,CAAT,EAAY;AACd,eAAOC,MAAM,CAACD,CAAC,CAAC5C,CAAH,CAAb;AACA,OAHY,EAIZC,CAJY,CAIV,UAAS2C,CAAT,EAAY;AACd,eAAOE,MAAM,CAACF,CAAC,CAACf,IAAH,CAAb;AACA,OANY,CAAd,CAZW,CAoBX;;AACA,UAAIgB,MAAM,GAAGnE,EAAE,CAACqE,WAAH,GACXC,MADW,CACJ,CAAC,CAAD,EAAGtE,EAAE,CAACuE,GAAH,CAAOR,OAAP,EAAgB,UAASG,CAAT,EAAW;AACrC,eAAOA,CAAC,CAAC5C,CAAT;AACA,OAFU,CAAH,CADI,EAIXkD,KAJW,CAIL,CAACV,OAAD,EAASF,CAAC,GAAGE,OAAO,GAAC,CAArB,CAJK,CAAb;AAKA,UAAIM,MAAM,GAAGpE,EAAE,CAACqE,WAAH,GACXC,MADW,CACJ,CACPtE,EAAE,CAACyE,GAAH,CAAOV,OAAP,EAAgB,UAASG,CAAT,EAAW;AAC1B,eAAOA,CAAC,CAAC3C,CAAT;AACA,OAFD,CADO,EAIPvB,EAAE,CAACuE,GAAH,CAAOR,OAAP,EAAgB,UAASG,CAAT,EAAW;AACxB,eAAOA,CAAC,CAAC3C,CAAT;AACF,OAFD,CAJO,CADI,EAQT;AARS,OASXiD,KATW,CASL,CAACX,CAAC,GAACC,OAAH,EAAYA,OAAZ,CATK,CAAb,CA1BW,CAqCX;;AACA,UAAIY,KAAK,GAAG1E,EAAE,CAAC2E,UAAH,GACVC,KADU,CACJT,MADI,CAAZ;AAGA,UAAIU,KAAK,GAAG7E,EAAE,CAAC8E,QAAH,GACVF,KADU,CACJR,MADI,EAEVW,KAFU,CAEJ,CAFI,CAAZ,CAzCW,CA6CX;AACI;;AACA,UAAIC,OAAO,GAAGhF,EAAE,CAAC0D,MAAH,CAAU,mBAAV,EACbuB,MADa,CACN,KADM,EAEbC,KAFa,CAEP,SAFO,EAEI,CAFJ,EAGbC,IAHa,CAGR,OAHQ,EAGC,SAHD,CAAd,CA/CO,CAoDP;AACA;;AACD,UAAIC,SAAS,GAAG,SAAZA,SAAY,CAASlB,CAAT,EAAY;AACxBlE,QAAAA,EAAE,CAAC0D,MAAH,CAAU,4BAAV,EAAwCwB,KAAxC,CAA8C,SAA9C,EAAyD,CAAzD,EACJG,IADI,CACCnB,CAAC,CAACpC,GAAF,CAAMhB,IADP;AAEN,OAHE;;AAKA,UAAIwE,SAAS,GAAG,SAAZA,SAAY,CAASpB,CAAT,EAAY;AACxBlE,QAAAA,EAAE,CAAC0D,MAAH,CAAU,4BAAV,EACJwB,KADI,CACE,MADF,EACWlF,EAAE,CAACuF,KAAH,CAASC,KAAV,GAAmB,IAD7B,EAEJN,KAFI,CAEE,KAFF,EAEUlF,EAAE,CAACuF,KAAH,CAASE,KAAT,GAAiB,EAAlB,GAAwB,IAFjC;AAGH,OAJD,CA3DQ,CAiEP;;;AACD,UAAIC,UAAU,GAAG,SAAbA,UAAa,CAASxB,CAAT,EAAY;AACzBlE,QAAAA,EAAE,CAAC0D,MAAH,CAAU,4BAAV,EAAwCiC,UAAxC,GACEC,QADF,CACW,GADX,EAEEV,KAFF,CAEQ,SAFR,EAEmB,CAFnB;AAGH,OAJD,CAlEQ,CAwEX;;;AACA,UAAIW,GAAG,GAAG7F,EAAE,CAAC0D,MAAH,CAAU,mBAAV,EACRuB,MADQ,CACD,KADC,EAERE,IAFQ,CAEH,IAFG,EAEE,qBAFF,EAGRA,IAHQ,CAGH,OAHG,EAGKvB,CAHL,EAIRuB,IAJQ,CAIH,QAJG,EAIOtB,CAJP,CAAV,CAzEW,CA+EX;;AACAgC,MAAAA,GAAG,CAACZ,MAAJ,CAAW,UAAX,EACEE,IADF,CACO,IADP,EACa,YADb,EAEEF,MAFF,CAES,MAFT,EAGEE,IAHF,CAGO,GAHP,EAGYrB,OAHZ,EAIEqB,IAJF,CAIO,GAJP,EAIYrB,OAJZ,EAKEqB,IALF,CAKO,OALP,EAKgBvB,CAAC,GAACE,OAAO,GAAG,CAL5B,EAMEqB,IANF,CAMO,QANP,EAMiBtB,CAAC,GAACC,OAAO,GAAE,CAN5B,EAhFW,CAwFX;;AACA+B,MAAAA,GAAG,CAACZ,MAAJ,CAAW,GAAX,EACEE,IADF,CACO,IADP,EACa,SADb,EAEEA,IAFF,CAEO,WAFP,EAEoB,kBAFpB,EAGEW,SAHF,CAGY,QAHZ,EAIE/D,IAJF,CAIOgC,OAJP,EAIgB,UAASG,CAAT,EAAW;AAAC,eAAOA,CAAP;AAAU,OAJtC,EAKE6B,KALF,GAMEd,MANF,CAMS,QANT,EAOEE,IAPF,CAOO,OAPP,EAOgB,KAPhB,EAQEA,IARF,CAQO,IARP,EAQa,UAASjB,CAAT,EAAW;AACtB,eAAOC,MAAM,CAACD,CAAC,CAAC5C,CAAH,CAAb;AACA,OAVF,EAWE6D,IAXF,CAWO,IAXP,EAWa,UAASjB,CAAT,EAAW;AACtB,eAAOE,MAAM,CAACF,CAAC,CAAC3C,CAAH,CAAb;AACA,OAbF,EAcE4D,IAdF,CAcO,GAdP,EAcY,GAdZ,EAeEa,EAfF,CAeK,WAfL,EAekBZ,SAflB,EAgBEY,EAhBF,CAgBK,WAhBL,EAgBkBV,SAhBlB,EAiBEU,EAjBF,CAiBK,YAjBL,EAiBmBN,UAjBnB,EAzFW,CA4GX;;AACAG,MAAAA,GAAG,CAACZ,MAAJ,CAAW,MAAX,EACEgB,KADF,CACQlC,OADR,EAEEoB,IAFF,CAEO,WAFP,EAEoB,kBAFpB,EAGEA,IAHF,CAGO,OAHP,EAGgB,MAHhB,EAIEA,IAJF,CAIO,GAJP,EAIYnB,OAJZ,EA7GW,CAmHX;;AACA6B,MAAAA,GAAG,CAACZ,MAAJ,CAAW,GAAX,EACEE,IADF,CACO,OADP,EACgB,QADhB,EAEEA,IAFF,CAEO,WAFP,EAEoB,kBAAkBtB,CAAC,GAACC,OAApB,IAA+B,GAFnD,EAGEoC,IAHF,CAGOxB,KAHP;AAKAmB,MAAAA,GAAG,CAACZ,MAAJ,CAAW,GAAX,EACEE,IADF,CACO,OADP,EACgB,QADhB,EAEEA,IAFF,CAEO,WAFP,EAEoB,eAAerB,OAAf,GAAyB,KAF7C,EAGEoC,IAHF,CAGOrB,KAHP,EAzHW,CA8HX;;AACA,WAAKpE,KAAL,CAAW0F,kBAAX;AACA;;;;AAoFD;;;;kCAIc;AACb,UAAG,KAAK/F,KAAL,CAAWC,SAAX,IAAwB,KAAKD,KAAL,CAAWG,SAAtC,EACC,KAAKE,KAAL,CAAW2F,WAAX,CAAuB,CAAC,KAAKhG,KAAL,CAAWC,SAAZ,EAAsB,KAAKD,KAAL,CAAWG,SAAjC,CAAvB;AACD;;;0CAEoB;AACpB;AACA,UAAI,KAAKE,KAAL,CAAWC,IAAX,CAAgBF,QAAhB,KAA6B,KAAKJ,KAAL,CAAWI,QAA5C,EAAqD;AACpD,aAAK6C,QAAL,CAAc;AACb7C,UAAAA,QAAQ,EAAG,KAAKC,KAAL,CAAWC,IAAX,CAAgBF,QADd;AAEbH,UAAAA,SAAS,EAAEC,SAFE;AAGbC,UAAAA,SAAS,EAAED;AAHE,SAAd;AAKAN,QAAAA,EAAE,CAAC0D,MAAH,CAAU,sBAAV,EAAkCC,MAAlC;AACA;AACD;AAED;;;;;;;6BAIS;AACF,aACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACL;AAAK,QAAA,EAAE,EAAC,kBAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADK,EAEL,oBAAC,YAAD;AAAc,QAAA,EAAE,EAAC,OAAjB;AACgB,QAAA,SAAS,EAAE,KAAKlD,KAAL,CAAW4F,SADtC;AAEgB,QAAA,UAAU,EAAE,KAAKjD,WAFjC;AAGgB,QAAA,YAAY,EAAE,KAAKhD,KAAL,CAAWC,SAHzC;AAIgB,QAAA,WAAW,EAAE,KAAKI,KAAL,CAAW6F,CAAX,CAAa,6BAAb,CAJ7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFK,EAQL,oBAAC,YAAD;AAAc,QAAA,EAAE,EAAC,OAAjB;AACgB,QAAA,SAAS,EAAE,KAAK7F,KAAL,CAAW4F,SADtC;AAEgB,QAAA,UAAU,EAAE,KAAK9C,WAFjC;AAGgB,QAAA,YAAY,EAAE,KAAKnD,KAAL,CAAWG,SAHzC;AAIgB,QAAA,WAAW,EAAE,KAAKE,KAAL,CAAW6F,CAAX,CAAa,6BAAb,CAJ7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARK,CADD;AAkBN;;;;EA1T6BvG,S;;AA6T/B,IAAMwG,yBAAyB,GAAGrG,eAAe,GAAGC,gBAAH,CAAjD;AACA,eAAeoG,yBAAf","sourcesContent":["import React, { Component } from 'react'\nimport * as d3 from \"d3\";\nimport './LinearRegression.css'\nimport DropdownMenu from './../DropdownMenu/DropdownMenu.js';\nimport { withTranslation } from 'react-i18next';\n\n/**\n* LinearRegression is the entity we use to calculate and draw a scatterplot with a regression line.\n* The rendered JSX also consists of two dropdowns where variables can be selected to display a scatterplot.\n* The currently selected variables and language are stored in the state.\n*/\nclass LinearRegression extends Component {\n\n\tstate = {\n        xVariable : undefined,\n        yVariable : undefined,\n\t\tlanguage: this.props.i18n.language,\n\t};\n\n\tcomponentDidUpdate(){\n\t\t// check if response is there and draw chart if so\n\t\tif(this.props.tableDataLoaded)\n\t\t\tthis.drawChart();\n\t}\n\n\t/**\n\t* Returns the values stored in a this.props.objects canton/hospital\n\t* @param  {Canton || Hospital Object} item The object to extract the values from\n\t* @return {Object} with x: Data for the xVariable and y: Data for the yVariable\n\t*/\n   returnData = (item) => {\n\t   let xVarName = this.state.xVariable.name;\n\t   let yVarName = this.state.yVariable.name;\n\t   let xValues = item.attributes[xVarName];\n\t   let yValues = item.attributes[yVarName];\n\t   let xData = xValues[this.props.year];\n\t   let yData = yValues[this.props.year];\n\t   return {\n\t\t   x: xData,\n\t\t   y: yData,\n\t   };\n   }\n\n   /**\n\t* Returns an Object with arrays containing all Values of the chosen variables\n\t* @return {Object} with x: all data values for the xVariable and y: all data values for the yVariable\n\t*/\n   makeDataArrays = () => {\n\t   let xArray = [];\n\t   let yArray = [];\n\t   let objArray = [];\n\t   this.props.hospitals.map((obj) => {\n\t\t   let data = this.returnData(obj);\n\t\t   if (data.x && data.y){ // sort out undefined values for given year\n\t\t\t\txArray.push(data.x);\n\t\t\t\tyArray.push(data.y);\n\t\t\t\tobjArray.push(obj);\n\t\t   }\n\t   })\n\t   return {\n\t\t   x: xArray,\n\t\t   y: yArray,\n\t\t   obj: objArray, //pointer to the hospital\n\t   };\n   }\n\n\t/**\n\t * Draws a Scatterplot with a regression line\n\t */\n\tdrawChart() {\n\t\t//remove old svg\n\t\td3.select(\"#linearregressionsvg\").remove();\n\n\t\tvar w = 960;\n\t\tvar h = 500;\n\t\tvar padding = 30;\n\n\t\t//create data points\n\t\tvar dataset = this.createChartdata();\n\n\t\t// function for creation of regression line\n\t\tvar newline = d3.line()\n\t\t\t.x(function(d) {\n\t\t\t\treturn xScale(d.x);\n\t\t\t})\n\t\t\t.y(function(d) {\n\t\t\t\treturn yScale(d.yhat);\n\t\t\t});\n\n\t\t// Define Scales\n\t\tvar xScale = d3.scaleLinear()\n\t\t\t.domain([0,d3.max(dataset, function(d){\n\t\t\t\treturn d.x;\n\t\t\t})])\n\t\t\t.range([padding,w - padding*2]);\n\t\tvar yScale = d3.scaleLinear()\n\t\t\t.domain([\n\t\t\t\td3.min(dataset, function(d){\n\t\t\t\t\treturn(d.y);\n\t\t\t\t}),\n\t\t\t\td3.max(dataset, function(d){\n\t\t\t  \t\treturn d.y;\n\t\t\t\t})\n\t\t\t]) //y range is reversed because svg\n\t\t\t.range([h-padding, padding]);\n\n\t\t// Define Axis\n\t\tvar xAxis = d3.axisBottom()\n\t\t\t.scale(xScale);\n\n\t\tvar yAxis = d3.axisLeft()\n\t\t\t.scale(yScale)\n\t\t\t.ticks(5);\n\n\t\t// Add a tooltip div. Here I define the general feature of the tooltip: stuff that do not depend on the data point.\n     \t// Its opacity is set to 0: we don't see it by default.\n     \tvar tooltip = d3.select(\"#linearregression\")\n\t\t    .append(\"div\")\n\t\t    .style(\"opacity\", 0)\n\t\t    .attr(\"class\", \"tooltip\")\n\n     \t// function that changes  tooltip when the user hovers over a point.\n     \t// opacity is set to 1: we can now see it. Plus it set the text and position of tooltip depending on the datapoint (d)\n    \tvar mouseover = function(d) {\n       \t\td3.select(\"#linearregression .tooltip\").style(\"opacity\", 1)\n\t\t\t\t.text(d.obj.name);\n\t\t}\n\n    \tvar mousemove = function(d) {\n       \t\td3.select(\"#linearregression .tooltip\")\n\t\t\t\t.style(\"left\", (d3.event.pageX) + \"px\")\n\t\t\t\t.style(\"top\", (d3.event.pageY - 28) + \"px\");\n    \t}\n\n     \t// A function that change this tooltip when the leaves a point: just need to set opacity to 0 again\n    \tvar mouseleave = function(d) {\n       \t\td3.select(\"#linearregression .tooltip\").transition()\n        \t\t.duration(200)\n        \t\t.style(\"opacity\", 0)\n    \t}\n\n\t\t// create svg\n\t\tvar svg = d3.select(\"#linearregression\")\n\t\t\t.append(\"svg\")\n\t\t\t.attr(\"id\",\"linearregressionsvg\")\n\t\t\t.attr(\"width\",w)\n\t\t\t.attr(\"height\", h);\n\n\t\t// cut off datapoints that are outside the axis\n\t\tsvg.append(\"clipPath\")\n\t\t\t.attr(\"id\", \"chart-area\")\n\t\t\t.append(\"rect\")\n\t\t\t.attr(\"x\", padding)\n\t\t\t.attr(\"y\", padding)\n\t\t\t.attr(\"width\", w-padding * 3)\n\t\t\t.attr(\"height\", h-padding *2);\n\n\t\t// append data points\n\t\tsvg.append(\"g\")\n\t\t\t.attr(\"id\", \"circles\")\n\t\t\t.attr(\"clip-path\", \"url(#chart-area)\")\n\t\t\t.selectAll(\"circle\")\n\t\t\t.data(dataset, function(d){return d;})\n\t\t\t.enter()\n\t\t\t.append(\"circle\")\n\t\t\t.attr(\"class\", \"dot\")\n\t\t\t.attr(\"cx\", function(d){\n\t\t\t\treturn xScale(d.x);\n\t\t\t})\n\t\t\t.attr(\"cy\", function(d){\n\t\t\t\treturn yScale(d.y);\n\t\t\t})\n\t\t\t.attr(\"r\", 3.5)\n\t\t\t.on(\"mouseover\", mouseover)\n\t\t\t.on(\"mousemove\", mousemove)\n\t\t\t.on(\"mouseleave\", mouseleave);\n\n\t\t// append regression line\n\t\tsvg.append(\"path\")\n\t\t\t.datum(dataset)\n\t\t\t.attr(\"clip-path\", \"url(#chart-area)\")\n\t\t\t.attr(\"class\", \"line\")\n\t\t\t.attr(\"d\", newline);\n\n\t\t// append Axes\n\t\tsvg.append(\"g\")\n\t\t\t.attr(\"class\", \"x axis\")\n\t\t\t.attr(\"transform\", \"translate(0,\" + (h-padding) + \")\")\n\t\t\t.call(xAxis);\n\n\t\tsvg.append(\"g\")\n\t\t\t.attr(\"class\", \"y axis\")\n\t\t\t.attr(\"transform\", \"translate(\" + padding + \",0)\")\n\t\t\t.call(yAxis);\n\n\t\t// call this to set back and prepare for reupdate\n\t\tthis.props.tableDataGenerated();\n\t}\n\n\tfindHospitalInfo = (x, y, xArr, yArr) => {\n\n\t}\n\n\tcreateChartdata = () => {\n\t\tlet dataArrays = this.makeDataArrays();\n\t\tvar x = dataArrays.x;\n\t\tvar y = dataArrays.y;\n\t\tvar obj = dataArrays.obj;\n\t\tvar n = x.length;\n\n\t\t// create x and y sums\n\t\tlet xSum = 0;\n\t\tlet ySum = 0;\n\t\tfor (var i = 0; i < n; i++) {\n\t\t\txSum += x[i]\n\t\t\tySum += y[i]\n\t\t}\n\n\t\t// calculate mean x and y\n\t\tlet xMean = xSum / n;\n\t\tlet yMean = ySum / n;\n\n\t\t// calculate coefficients\n\t\tvar xvariance = 0;\n\t\tvar yvariance = 0;\n\t\tvar term1 = 0;\n\t\tvar term2 = 0;\n\t\tfor (i = 0; i < x.length; i++) {\n\t\t\txvariance = x[i] - xMean;\n\t\t\tyvariance = y[i] - yMean;\n\t\t\tterm1 += xvariance * yvariance;\n\t\t\tterm2 += xvariance * xvariance;\n\t\t}\n\t\tvar b1 = term1 / term2;\n\t\tvar b0 = yMean - (b1 * xMean);\n\n\t\t// perform regression\n\t\tlet yhat = [];\n\n\t\t// fit line using coeffs\n\t\tfor (i = 0; i < x.length; i++) {\n\t\t\tyhat.push(b0 + (x[i] * b1));\n\t\t}\n\n\t\t// create actual data objects\n\t\tvar data = [];\n\t\tfor (i = 0; i < y.length && i < x.length; i++) {\n\t\t\tdata.push({\n\t\t\t\tyhat: yhat[i],\n\t\t\t\ty: y[i],\n\t\t\t\tx: x[i],\n\t\t\t\tobj: obj[i],\n\t\t\t})\n\t\t}\n\t\treturn data;\n\t}\n\n\t/**\n    * defining behaviour on dropdown click\n\t* write the selected variable to state and update chart on X axis\n    */\n    selectXAxis = (item) => {\n\t\tthis.setState({\n\t\t\txVariable : item,\n\t\t}, () => {\n\t\t\tthis.updateChart();\n\t\t});\n\t}\n\n\t/**\n    * defining behaviour on dropdown click\n\t* write the selected variable to state and update chart on Y axis\n    */\n    selectYAxis = (item) => {\n\t\tthis.setState({\n\t\t\tyVariable : item,\n\t\t}, () => {\n\t\t\tthis.updateChart();\n\t\t});\n\t}\n\n\t/**\n\t* check if both x and y variable have been selected\n\t* update selected variables in state if so\n\t*/\n\tupdateChart() {\n\t\tif(this.state.xVariable && this.state.yVariable)\n\t\t\tthis.props.requestData([this.state.xVariable,this.state.yVariable]);\n\t}\n\n\tcomponentWillUpdate(){\n\t\t// if the language is changed,set back variables and remove chart\n\t\tif (this.props.i18n.language !== this.state.language){\n\t\t\tthis.setState({\n\t\t\t\tlanguage : this.props.i18n.language,\n\t\t\t\txVariable: undefined,\n\t\t\t\tyVariable: undefined,\n\t\t\t});\n\t\t\td3.select(\"#linearregressionsvg\").remove();\n\t\t}\n\t}\n\n\t/**\n\t * Creates zwo dropdowns and scatterplot with regression line\n\t * @return {JSX}\n\t */\n\trender() {\n        return (\n        \t<div>\n\t\t\t\t<div id=\"linearregression\"></div>\n\t\t\t\t<DropdownMenu id=\"xAxis\"\n                    listItems={this.props.variables}\n                    selectItem={this.selectXAxis}\n                    selectedItem={this.state.xVariable}\n                    defaultText={this.props.t('dropDowns.variablesFallback')}\n                />\n\t\t\t\t<DropdownMenu id=\"yAxis\"\n                    listItems={this.props.variables}\n                    selectItem={this.selectYAxis}\n                    selectedItem={this.state.yVariable}\n                    defaultText={this.props.t('dropDowns.variablesFallback')}\n                />\n\t\t\t</div>\n\n        )\n\t}\n}\n\nconst LocalizedLinearRegression = withTranslation()(LinearRegression);\nexport default LocalizedLinearRegression;\n"]},"metadata":{},"sourceType":"module"}